{% extends "base.html" %}

{% block head %}
<style>
    .content-wrapper {
        max-width: 700px;
        margin: 40px auto;
        backdrop-filter: blur(10px);
        background: rgba(20, 25, 50, 0.4);
        border: 1px solid rgba(100, 100, 255, 0.15);
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 8px 32px rgba(0, 217, 255, 0.1);
    }

    .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        text-align: center;
        font-family: 'Space Grotesk', sans-serif;
        background: linear-gradient(135deg, #00d9ff, #9d4edd);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 30px;
    }

    #wishlist-items .wishlist-list {
        list-style: none;
        padding: 0;
    }

    #wishlist-items .wishlist-list li {
        background: rgba(30, 35, 70, 0.6);
        border: 1.5px solid rgba(100, 120, 255, 0.25);
        border-radius: 12px;
        padding: 15px 20px;
        margin-bottom: 15px;
        font-size: 1.1rem;
        color: #e0e0ff;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s ease;
    }

    #wishlist-items .wishlist-list li:hover {
        border-color: rgba(0, 217, 255, 0.5);
        background: rgba(30, 40, 80, 0.8);
    }

    .remove-btn {
        background: rgba(255, 77, 109, 0.2);
        color: #ff79c6;
        border: 1px solid rgba(255, 77, 109, 0.4);
        padding: 8px 15px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .remove-btn:hover {
        background: rgba(255, 77, 109, 0.4);
        color: #fff;
        box-shadow: 0 0 10px rgba(255, 77, 109, 0.5);
    }

    .empty-wishlist-message, .back-action {
        text-align: center;
        margin-top: 20px;
    }

    .empty-wishlist-message p {
        font-size: 1.2rem;
        color: #a0a0c0;
    }

</style>
{% endblock %}

{% block content %}
<div class="content-wrapper">
    <h1 class="page-title">Your Wishlist</h1>

    <div id="wishlist-items">
        {% if wishlist_items %}
            <ul class="wishlist-list">
                {% for item in wishlist_items %}
                    <li id="wishlist-item-{{ item.id }}">
                        <span>{{ item.name }} - Rs. {{ item.price }}</span>
                        <button class="remove-btn" data-product-id="{{ item.id }}">Remove</button>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <div class="empty-wishlist-message"><p>Your wishlist is empty.</p></div>
        {% endif %}
    </div>

    <div class="back-action">
        <a href="{{ url_for('home') }}" class="theme-button">Back to Home</a>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const wishlistContainer = document.getElementById('wishlist-items');
        const wishlistCountBadge = document.getElementById('wishlist-badge');

        wishlistContainer.addEventListener('click', function(e) {
            if (e.target.classList.contains('remove-btn')) {
                e.preventDefault();
                const productId = e.target.dataset.productId;
                
                fetch('/remove_from_wishlist/' + productId, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Remove item from DOM
                        const listItem = document.getElementById('wishlist-item-' + productId);
                        if (listItem) {
                            listItem.remove();
                        }

                        // Update wishlist count in navbar
                        if (wishlistCountBadge) {
                            wishlistCountBadge.textContent = data.wishlist_count;
                            wishlistCountBadge.style.display = data.wishlist_count > 0 ? 'inline-block' : 'none';
                        }

                        // If wishlist becomes empty, display message
                        if (data.wishlist_count === 0) {
                            wishlistContainer.innerHTML = '<div class="empty-wishlist-message"><p>Your wishlist is empty.</p></div>';
                        }
                    } else {
                        // Handle error, e.g., display a flash message
                        console.error('Error removing from wishlist:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Network error:', error);
                });
            }
        });
    });
</script>
{% endblock %}