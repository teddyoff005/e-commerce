<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>One Stop Store</title>
    <!-- Google Fonts for a modern look -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%);
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 48px auto;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 8px 32px rgba(60,72,88,0.13);
            padding: 48px 56px 56px 56px;
        }
        h1 {
            font-size: 2.8rem;
            font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
            font-weight: 900;
            color: #232946;
            margin-bottom: 0.5em;
            letter-spacing: 2px;
            text-shadow: 0 4px 24px rgba(98,70,234,0.10);
        }
        .nav {
            margin-bottom: 32px;
        }
        .nav a {
            color: #6246ea;
            text-decoration: none;
            margin-right: 24px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: color 0.2s;
        }
        .nav a:hover {
            color: #16a34a;
        }
        h2 {
            font-size: 2rem;
            margin-top: 32px;
            margin-bottom: 18px;
            color: #232946;
            font-weight: 700;
        }
        .section-title {
            font-size: 1.5rem;
            margin-top: 36px;
            margin-bottom: 18px;
            color: #6246ea;
            font-weight: 800;
            letter-spacing: 1px;
        }
        .search-bar {
            width: 100%;
            max-width: 400px;
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .search-bar input[type="text"] {
            width: 100%;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1.5px solid #c7d2fe;
            font-size: 1.08rem;
            background: #f3f4f8;
            transition: border 0.2s;
        }
        .search-bar input[type="text"]:focus {
            border: 1.5px solid #6246ea;
            outline: none;
        }
        .search-btn {
            background: #6246ea;
            color: #fff;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .search-btn:hover {
            background: #16a34a;
        }
        .products-section {
            margin-bottom: 40px;
        }
        .products-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 28px;
        }
        .product-card {
            background: linear-gradient(135deg, #e0e7ff 0%, #f1f5f9 100%);
            border-radius: 14px;
            padding: 28px 22px 22px 22px;
            box-shadow: 0 2px 12px rgba(60,72,88,0.07);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            transition: box-shadow 0.2s, transform 0.2s;
            border: 2px solid #c7d2fe;
            position: relative;
        }
        .product-card:hover {
            box-shadow: 0 8px 32px rgba(60,72,88,0.16);
            transform: translateY(-3px) scale(1.02);
            border-color: #6246ea;
        }
        .product-name {
            font-size: 1.18rem;
            font-weight: 700;
            color: #232946;
            margin-bottom: 8px;
            font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
        }
        .product-variety {
            font-size: 1rem;
            color: #4a4e69;
            margin-bottom: 8px;
        }
        .product-price {
            font-size: 1.08rem;
            color: #16a34a;
            margin-bottom: 18px;
            font-weight: 600;
        }
        .add-btn {
            background: linear-gradient(90deg, #6246ea 60%, #16a34a 100%);
            color: #fff;
            border: none;
            padding: 10px 28px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
            text-decoration: none;
            box-shadow: 0 2px 8px rgba(98,70,234,0.08);
            margin-top: auto;
            align-self: flex-end;
        }
        .add-btn:hover {
            background: linear-gradient(90deg, #16a34a 60%, #6246ea 100%);
            box-shadow: 0 4px 16px rgba(22,163,74,0.13);
        }
        @media (max-width: 900px) {
            .container {
                padding: 18px 2vw 32px 2vw;
            }
            h1 {
                font-size: 2rem;
            }
        }
        @media (max-width: 600px) {
            .products-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <script>
        function filterProducts() {
            const input = document.getElementById('searchInput').value.toLowerCase().trim();
            const productSections = document.querySelectorAll('.product-category-section');
            
            if (input === '') {
                // Show all products when search is empty
                productSections.forEach(section => {
                    section.style.display = '';
                    const cards = section.querySelectorAll('.product-card');
                    cards.forEach(card => card.style.display = '');
                });
                return;
            }
            
            productSections.forEach(section => {
                let foundInSection = false;
                const cards = section.querySelectorAll('.product-card');
                
                cards.forEach(card => {
                    const categoryName = card.getAttribute('data-name') ? card.getAttribute('data-name').toLowerCase() : '';
                    const varietyName = card.getAttribute('data-variety') ? card.getAttribute('data-variety').toLowerCase() : '';
                    
                    // Search in category name, variety name, and also check for partial matches
                    if (categoryName.includes(input) || 
                        varietyName.includes(input) ||
                        categoryName.split(' ').some(word => word.startsWith(input)) ||
                        varietyName.split(' ').some(word => word.startsWith(input))) {
                        card.style.display = '';
                        foundInSection = true;
                    } else {
                        card.style.display = 'none';
                    }
                });
                
                // Show/hide entire category section
                section.style.display = foundInSection ? '' : 'none';
            });
        }
        
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            filterProducts();
        }
        
        // Add Enter key support
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        filterProducts();
                    }
                });
            }
        });
    </script>
</head>
<body>
    <div class="container">
        <h1>One Stop Store</h1>
        <div class="nav">
            {% if session.user %}
                Hello, <b>{{ session.user }}</b> |
                <a href="{{ url_for('logout') }}">Logout</a>
                <a href="{{ url_for('view_cart') }}">Cart</a>
                <a href="{{ url_for('my_orders') }}">My Orders</a>
            {% else %}
                <a href="{{ url_for('login') }}">Login</a>
                <a href="{{ url_for('register') }}">Register</a>
            {% endif %}
        </div>
        {% block content %}
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search products..." onkeyup="filterProducts()">
            <button class="search-btn" onclick="filterProducts()">Search</button>
            <button class="search-btn" onclick="clearSearch()" style="background: #dc2626;">Clear</button>
        </div>
        <h2 style="font-family: 'Montserrat', Arial, sans-serif; font-weight:900; color:#232946; margin-bottom:24px;">Products</h2>

        {% set categories = [
            'Laptop', 'Smartphone', 'Headphones', 'Smartwatch', 'Bluetooth Speaker', 'Tablet', 'Camera', 'Gaming Console', 'Television', 'Refrigerator', 'Washing Machine', 'Microwave Oven', 'Cycle', 'Bike', 'Car', 'Book', 'Dress (Men)', 'Dress (Women)', 'Dress (Kids)', 'Dress (Unisex)', 'Shoes', 'Sunglasses', 'Backpack', 'Desk Lamp', 'Wireless Mouse', 'Water Bottle', 'Air Conditioner', 'Gaming Laptop', 'Fitness Equipment', 'Kitchen Appliances', 'Home Decor', 'Pet Supplies', 'Office Supplies', 'Beauty & Personal Care', 'Sports & Outdoor', 'Travel & Luggage', 'Health & Wellness', 'Garden & Outdoor', 'Baby & Kids', 'Smart Home Devices', 'Automotive Accessories', 'Musical Instruments', 'Photography Equipment', 'Jewelry & Watches', 'Books & Stationery', 'Food & Beverages', 'Art & Craft Supplies', 'Tools & Hardware', 'Seasonal Items'
        ] %}

        {% for category in categories %}
            {% set cat_products = products | selectattr('name', 'equalto', category) | list %}
            {% if cat_products and cat_products[0].varieties %}
                <div class="product-category-section" style="margin-bottom:38px;">
                    <div style="font-size:1.35rem;font-family:'Montserrat',Arial,sans-serif;font-weight:800;color:#6246ea;margin-bottom:12px;">
                        {{ category }}
                    </div>
                    <div class="products-list" style="margin-bottom:0;">
                        {% for variety in cat_products[0].varieties %}
                        <div class="product-card" data-name="{{ category }}" data-variety="{{ variety.name }}">
                            <a href="{{ url_for('product_detail', pid=variety.id) }}" style="text-decoration:none;color:inherit;display:block;">
                                <span class="product-variety" style="font-weight:700;font-size:1.08rem;">{{ variety.name }}</span>
                                {% if variety.discount and variety.discount > 0 %}
                                    <span class="product-price" style="display:block;">
                                        <span style="text-decoration:line-through;color:#b91c1c;">Rs.{{ variety.price }}</span>
                                        <span style="color:#16a34a;font-weight:700;margin-left:8px;">
                                            Rs.{{ variety.price - (variety.price * variety.discount // 100) }}
                                        </span>
                                        <span style="color:#ff9800;font-size:0.95em;margin-left:6px;">
                                            ({{ variety.discount }}% OFF{% if variety.occasion %} - {{ variety.occasion }}{% endif %})
                                        </span>
                                    </span>
                                {% else %}
                                    <span class="product-price" style="display:block;">Rs.{{ variety.price }}</span>
                                {% endif %}
                                <span style="color:#6246ea;font-size:0.98rem;text-decoration:underline;display:inline-block;margin-top:8px;">View Details</span>
                            </a>
                            {% if session.user %}
                                <a class="add-btn" href="{{ url_for('add_to_cart', pid=variety.id) }}">Add to Cart</a>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        {% endfor %}

        {% endblock %}
    </div>
</body>
</html>